<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#050508">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<title>Moj Trening</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

:root {
  --bg: #050508;
  --card: #0f0f14;
  --card-border: rgba(255,255,255,0.04);
  --card-hover: #14141c;
  --green: #00d2a0;
  --green-glow: rgba(0,210,160,0.15);
  --green-dim: rgba(0,210,160,0.08);
  --orange: #ff9f43;
  --orange-glow: rgba(255,159,67,0.12);
  --purple: #7c5cfc;
  --purple-glow: rgba(124,92,252,0.12);
  --red: #ff5757;
  --red-glow: rgba(255,87,87,0.1);
  --text: #e8e8ed;
  --text-dim: #5a5a6e;
  --text-mid: #8a8a9e;
  --radius: 16px;
  --radius-sm: 10px;
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html { scroll-behavior: smooth; }
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  padding: 0 16px 90px;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
}

/* ====== HEADER ====== */
.header {
  text-align: center;
  padding: 24px 0 12px;
  position: relative;
}
.header::after {
  content: '';
  position: absolute;
  top: -40px; left: 50%; transform: translateX(-50%);
  width: 200px; height: 200px;
  background: radial-gradient(circle, var(--green-glow) 0%, transparent 70%);
  pointer-events: none;
  opacity: 0.6;
}
.today-date {
  font-size: 11px; color: var(--text-dim);
  text-transform: uppercase; letter-spacing: 3px;
  font-weight: 600;
}
.today-day {
  font-size: 30px; font-weight: 900; margin: 4px 0 8px;
  color: #fff;
}
.page-title {
  font-size: 26px; font-weight: 900; text-align: center;
  padding: 24px 0 16px; color: #fff;
}
.status-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 8px 20px; border-radius: 24px;
  font-size: 11px; font-weight: 700; letter-spacing: 1px;
  text-transform: uppercase;
}
.status-training {
  background: linear-gradient(135deg, rgba(0,210,160,0.2), rgba(0,180,200,0.15));
  color: var(--green);
  border: 1px solid rgba(0,210,160,0.25);
  box-shadow: 0 0 20px rgba(0,210,160,0.1);
}
.status-training::before { content: ''; width: 6px; height: 6px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }
@keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
.status-rest {
  background: rgba(255,255,255,0.03);
  color: var(--text-dim); border: 1px solid var(--card-border);
}

/* ====== ACTION BUTTONS ====== */
.action-row {
  display: flex; gap: 10px;
  margin: 16px 0 0;
}
.action-btn {
  flex: 1;
  display: flex; align-items: center; justify-content: center; gap: 8px;
  padding: 16px 10px;
  border-radius: var(--radius);
  font-size: 14px; font-weight: 700;
  font-family: inherit;
  cursor: pointer;
  transition: all 0.2s;
  border: none;
}
.action-btn:active { transform: scale(0.96); }
.action-done {
  background: linear-gradient(135deg, rgba(0,210,160,0.15), rgba(0,180,200,0.1));
  border: 1px solid rgba(0,210,160,0.25);
  color: var(--green);
}
.action-done:active { background: rgba(0,210,160,0.25); }
.action-skip {
  background: rgba(255,159,67,0.08);
  border: 1px solid rgba(255,159,67,0.2);
  color: var(--orange);
}
.action-skip:active { background: rgba(255,159,67,0.15); }

.toast {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%) scale(0.8);
  padding: 20px 32px;
  border-radius: var(--radius);
  font-size: 15px; font-weight: 700;
  font-family: inherit;
  z-index: 1000;
  opacity: 0;
  pointer-events: none;
  animation: toastPop 1.6s ease forwards;
  text-align: center;
  backdrop-filter: blur(20px);
}
.toast-done {
  background: rgba(0,210,160,0.2);
  border: 1px solid rgba(0,210,160,0.3);
  color: var(--green);
  box-shadow: 0 0 40px rgba(0,210,160,0.15);
}
.toast-skip {
  background: rgba(255,159,67,0.2);
  border: 1px solid rgba(255,159,67,0.3);
  color: var(--orange);
  box-shadow: 0 0 40px rgba(255,159,67,0.15);
}
.toast-icon { font-size: 36px; display: block; margin-bottom: 8px; }
@keyframes toastPop {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
  15% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  75% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
}

/* ====== WEIGHT INPUT ====== */
.weight-row {
  display: flex; align-items: center; gap: 6px;
  margin-top: 6px;
}
.weight-input {
  width: 64px;
  padding: 5px 8px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 8px;
  color: var(--text);
  font-size: 13px; font-weight: 600;
  font-family: inherit;
  text-align: center;
  outline: none;
  transition: border-color 0.2s;
}
.weight-input:focus { border-color: var(--green); }
.weight-input::placeholder { color: var(--text-dim); font-weight: 400; }
.weight-label { font-size: 11px; color: var(--text-dim); font-weight: 500; }
.weight-ok {
  padding: 5px 12px;
  background: var(--green-dim);
  border: 1px solid rgba(0,210,160,0.2);
  border-radius: 8px;
  color: var(--green);
  font-size: 12px; font-weight: 800;
  font-family: inherit; cursor: pointer;
  transition: all 0.2s;
}
.weight-ok:active { transform: scale(0.92); }
.weight-ok.saved {
  background: rgba(0,210,160,0.25);
  border-color: var(--green);
}
.weight-last { font-size: 10px; color: var(--purple); font-weight: 600; }

/* ====== TIMER ====== */
.timer-fab {
  position: fixed;
  bottom: calc(80px + var(--safe-bottom));
  right: 16px;
  width: 56px; height: 56px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--green), #00b488);
  border: none;
  color: #fff;
  font-size: 24px;
  cursor: pointer;
  z-index: 90;
  box-shadow: 0 4px 20px rgba(0,210,160,0.3);
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s;
}
.timer-fab:active { transform: scale(0.92); }
.timer-fab.running {
  background: linear-gradient(135deg, var(--orange), #e88a30);
  box-shadow: 0 4px 20px rgba(255,159,67,0.3);
  animation: pulse 1.5s infinite;
}
.timer-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(20px);
  z-index: 200;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  opacity: 0; pointer-events: none;
  transition: opacity 0.3s;
}
.timer-overlay.open { opacity: 1; pointer-events: auto; }
.timer-display {
  font-size: 72px; font-weight: 900;
  color: #fff;
  font-variant-numeric: tabular-nums;
  margin-bottom: 8px;
}
.timer-label {
  font-size: 14px; color: var(--text-dim);
  font-weight: 600; margin-bottom: 32px;
  text-transform: uppercase; letter-spacing: 2px;
}
.timer-presets {
  display: flex; gap: 10px;
  margin-bottom: 28px;
}
.timer-preset {
  padding: 12px 20px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  color: var(--text); font-size: 15px; font-weight: 700;
  font-family: inherit; cursor: pointer;
  transition: all 0.2s;
}
.timer-preset:active { transform: scale(0.95); }
.timer-preset.active {
  background: var(--green-dim);
  border-color: rgba(0,210,160,0.3);
  color: var(--green);
}
.timer-actions {
  display: flex; gap: 14px;
}
.timer-start {
  padding: 16px 40px;
  background: linear-gradient(135deg, var(--green), #00b488);
  border: none; border-radius: var(--radius);
  color: #fff; font-size: 16px; font-weight: 800;
  font-family: inherit; cursor: pointer;
  transition: all 0.2s;
}
.timer-start:active { transform: scale(0.96); }
.timer-stop {
  padding: 16px 40px;
  background: rgba(255,87,87,0.15);
  border: 1px solid rgba(255,87,87,0.25);
  border-radius: var(--radius);
  color: var(--red); font-size: 16px; font-weight: 800;
  font-family: inherit; cursor: pointer;
}
.timer-close {
  position: absolute; top: 20px; right: 20px;
  background: none; border: none;
  color: var(--text-dim); font-size: 28px;
  cursor: pointer; padding: 8px;
}
.timer-done-msg {
  font-size: 20px; font-weight: 800;
  color: var(--green);
  animation: pulse 0.8s infinite;
  margin-top: 16px;
}

/* ====== STATS PAGE ====== */
.stats-section {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  padding: 18px; margin: 14px 0;
  position: relative; overflow: hidden;
}
.stats-section::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--green-glow), transparent);
}
.stats-section h3 {
  font-size: 14px; font-weight: 800; color: var(--green);
  margin-bottom: 14px; text-transform: uppercase; letter-spacing: 1px;
}
.stats-section.body-section h3 { color: var(--purple); }
.stats-section.body-section::before {
  background: linear-gradient(90deg, transparent, var(--purple-glow), transparent);
}
.week-stats-grid {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.week-stat {
  background: rgba(255,255,255,0.03);
  border-radius: var(--radius-sm);
  padding: 14px; text-align: center;
}
.week-stat-val {
  font-size: 28px; font-weight: 900; color: #fff;
}
.week-stat-label {
  font-size: 11px; color: var(--text-dim); font-weight: 600;
  margin-top: 4px; text-transform: uppercase; letter-spacing: 0.5px;
}
.body-weight-input-row {
  display: flex; gap: 10px; margin-bottom: 16px;
}
.body-weight-input {
  flex: 1;
  padding: 12px 14px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius-sm);
  color: var(--text); font-size: 15px; font-weight: 600;
  font-family: inherit; outline: none;
}
.body-weight-input:focus { border-color: var(--purple); }
.body-weight-input::placeholder { color: var(--text-dim); }
.body-weight-save {
  padding: 12px 20px;
  background: var(--purple-glow);
  border: 1px solid rgba(124,92,252,0.25);
  border-radius: var(--radius-sm);
  color: var(--purple); font-size: 14px; font-weight: 700;
  font-family: inherit; cursor: pointer;
}
.chart-container {
  position: relative;
  width: 100%; height: 160px;
  margin-top: 8px;
}
.chart-container canvas {
  width: 100%; height: 100%;
}
.chart-empty {
  display: flex; align-items: center; justify-content: center;
  height: 120px; color: var(--text-dim); font-size: 13px;
}
.body-current {
  text-align: center; margin-bottom: 14px;
}
.body-current-val {
  font-size: 36px; font-weight: 900; color: #fff;
}
.body-current-unit {
  font-size: 14px; color: var(--text-dim); font-weight: 600;
}
.body-current-change {
  font-size: 12px; font-weight: 700; margin-top: 4px;
}
.ex-progress-list { list-style: none; }
.ex-progress-item {
  padding: 12px 0;
  border-bottom: 1px solid rgba(255,255,255,0.03);
}
.ex-progress-item:last-child { border-bottom: none; }
.ex-progress-name {
  font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 6px;
}
.ex-progress-bar-bg {
  height: 6px; border-radius: 3px;
  background: rgba(255,255,255,0.04);
  position: relative; overflow: hidden;
}
.ex-progress-bar {
  height: 100%; border-radius: 3px;
  background: linear-gradient(90deg, var(--green), #00e6b0);
  transition: width 0.5s ease;
}
.ex-progress-vals {
  display: flex; justify-content: space-between;
  margin-top: 4px;
}
.ex-progress-val {
  font-size: 11px; color: var(--text-dim); font-weight: 600;
}
.ex-progress-current {
  font-size: 11px; color: var(--green); font-weight: 700;
}

/* ====== QUOTE ====== */
.quote-box {
  margin: 16px auto 0;
  max-width: 340px;
  padding: 14px 20px;
  background: linear-gradient(135deg, rgba(124,92,252,0.08), rgba(0,210,160,0.06));
  border: 1px solid rgba(124,92,252,0.15);
  border-radius: var(--radius);
  position: relative;
}
.quote-text {
  font-size: 13px;
  font-weight: 500;
  color: var(--text);
  line-height: 1.55;
  font-style: italic;
}
.quote-author {
  font-size: 11px;
  color: var(--purple);
  font-weight: 700;
  margin-top: 8px;
  letter-spacing: 0.5px;
}
.quote-icon {
  position: absolute;
  top: -8px; left: 16px;
  font-size: 22px;
  opacity: 0.7;
}

/* ====== CARDS ====== */
.training-card {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  padding: 20px;
  margin: 16px 0;
  position: relative;
  overflow: hidden;
}
.training-card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--green-glow), transparent);
}
.training-card h2 {
  font-size: 18px; font-weight: 800; color: var(--green); margin-bottom: 2px;
}
.training-card h3 {
  font-size: 18px; font-weight: 800; color: var(--green); margin-bottom: 2px;
}
.training-card .subtitle, .training-card .muscles-tag {
  font-size: 12px; color: var(--text-dim); margin-bottom: 18px; font-weight: 500;
}

/* ====== EXERCISES ====== */
.exercise-list { list-style: none; }
.exercise-item {
  display: flex; align-items: flex-start;
  padding: 14px 0;
  border-bottom: 1px solid rgba(255,255,255,0.03);
  transition: background 0.2s;
}
.exercise-item:last-child { border-bottom: none; }
.exercise-num {
  width: 34px; height: 34px;
  background: var(--green-dim); color: var(--green);
  border-radius: var(--radius-sm);
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; font-weight: 800;
  flex-shrink: 0; margin-right: 14px; margin-top: 1px;
}
.exercise-info { flex: 1; min-width: 0; }
.exercise-name {
  font-size: 14px; font-weight: 600; line-height: 1.35;
  color: var(--text);
}
.exercise-meta {
  display: flex; align-items: center; gap: 6px;
  margin-top: 5px; flex-wrap: wrap;
}
.exercise-sets {
  font-size: 11px; color: var(--text-mid); font-weight: 600;
  background: rgba(255,255,255,0.04); padding: 3px 10px;
  border-radius: 6px;
}
.exercise-timestamp {
  font-size: 10px; color: var(--purple); font-weight: 700;
  background: var(--purple-glow); padding: 3px 8px;
  border-radius: 6px; letter-spacing: 0.3px;
}
.video-btn {
  display: inline-flex; align-items: center; gap: 6px;
  background: var(--red-glow); color: var(--red);
  font-size: 11px; font-weight: 700;
  padding: 7px 14px; border-radius: var(--radius-sm);
  text-decoration: none; margin-top: 8px;
  border: 1px solid rgba(255,87,87,0.12);
  transition: all 0.2s;
}
.video-btn:active { background: rgba(255,87,87,0.2); transform: scale(0.97); }
.video-btn svg { width: 12px; height: 12px; fill: var(--red); }

/* ====== ABS ====== */
.abs-card {
  background: linear-gradient(135deg, #13120a, #141008);
  border: 1px solid rgba(255,159,67,0.12);
  border-radius: var(--radius);
  padding: 20px; margin: 12px 0;
  position: relative; overflow: hidden;
}
.abs-card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--orange-glow), transparent);
}
.abs-card h3 { font-size: 16px; color: var(--orange); font-weight: 800; margin-bottom: 2px; }
.abs-card .subtitle { font-size: 11px; color: var(--text-dim); margin-bottom: 14px; font-weight: 500; }
.abs-exercise-num { background: rgba(255,159,67,0.1); color: var(--orange); }

/* ====== MONTH CALENDAR ====== */
.month-calendar {
  margin: 28px 0 24px;
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  padding: 20px 14px;
}
.month-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 16px; padding: 0 4px;
}
.month-header h3 { font-size: 16px; color: #fff; font-weight: 800; }
.month-nav {
  background: rgba(255,255,255,0.04); border: 1px solid var(--card-border);
  color: var(--text-mid); font-size: 16px;
  width: 38px; height: 38px; border-radius: var(--radius-sm);
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: all 0.15s;
}
.month-nav:active { background: rgba(255,255,255,0.08); transform: scale(0.95); }
.month-grid-header {
  display: grid; grid-template-columns: repeat(7, 1fr);
  gap: 3px; margin-bottom: 6px;
}
.month-grid-header div {
  text-align: center; font-size: 10px; color: var(--text-dim);
  font-weight: 700; padding: 4px; letter-spacing: 0.5px;
}
.month-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; }
.mcell {
  background: rgba(255,255,255,0.02); border-radius: 10px;
  padding: 7px 2px; text-align: center;
  min-height: 54px; cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.15s;
}
.mcell:active { transform: scale(0.92); }
.mcell.empty { background: transparent; cursor: default; }
.mcell.empty:active { transform: none; }
.mcell.today {
  border-color: var(--green);
  background: var(--green-dim);
  box-shadow: 0 0 12px rgba(0,210,160,0.1);
}
.mcell.training-day { background: rgba(255,255,255,0.04); }
.mcell .mday { font-size: 14px; font-weight: 700; color: #555; }
.mcell.today .mday { color: var(--green); font-weight: 800; }
.mcell.training-day .mday { color: #aaa; }
.mcell .mtraining {
  font-size: 8px; color: var(--green); font-weight: 800;
  margin-top: 1px; letter-spacing: 0.3px;
}
.mcell .mabs-dot {
  width: 4px; height: 4px; background: var(--orange);
  border-radius: 50%; margin: 3px auto 0;
  box-shadow: 0 0 4px rgba(255,159,67,0.4);
}

/* ====== DAY DETAIL ====== */
.day-detail-overlay {
  display: none; position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.75);
  z-index: 200; align-items: flex-end; justify-content: center;
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
}
.day-detail-overlay.open { display: flex; }
.day-detail-panel {
  background: #101015;
  border-radius: 24px 24px 0 0;
  padding: 16px 20px;
  padding-bottom: max(24px, var(--safe-bottom));
  width: 100%; max-width: 500px;
  max-height: 90vh; overflow-y: auto;
  animation: slideUp 0.35s cubic-bezier(0.16, 1, 0.3, 1);
  border-top: 1px solid rgba(255,255,255,0.06);
}
.day-detail-panel::-webkit-scrollbar { display: none; }
@keyframes slideUp {
  from { transform: translateY(100%); opacity: 0.5; }
  to { transform: translateY(0); opacity: 1; }
}
.panel-handle {
  width: 36px; height: 4px; background: #333;
  border-radius: 2px; margin: 4px auto 18px;
}
.day-detail-header {
  display: flex; justify-content: space-between;
  align-items: center; margin-bottom: 14px;
}
.day-detail-header h2 { font-size: 17px; font-weight: 800; color: #fff; }
.day-detail-close {
  background: rgba(255,255,255,0.06); border: none; color: var(--text-dim);
  width: 34px; height: 34px; border-radius: 50%;
  font-size: 18px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.15s;
}
.day-detail-close:active { background: rgba(255,255,255,0.12); }
.day-detail-badge {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 5px 14px; border-radius: 20px;
  font-size: 10px; font-weight: 700;
  margin-bottom: 8px; margin-right: 6px;
  letter-spacing: 0.5px; text-transform: uppercase;
}

/* ====== NEXT TRAININGS ====== */
.section-title {
  font-size: 14px; color: var(--text-dim); font-weight: 700;
  margin-bottom: 12px; letter-spacing: 0.5px; text-transform: uppercase;
}
.next-trainings { margin: 24px 0; }
.next-item {
  display: flex; align-items: center;
  padding: 14px 16px;
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  margin-bottom: 8px; cursor: pointer;
  transition: all 0.2s;
}
.next-item:active { background: var(--card-hover); transform: scale(0.98); }
.next-date { width: 46px; text-align: center; margin-right: 14px; }
.next-date .d { font-size: 22px; font-weight: 900; color: #fff; }
.next-date .m { font-size: 9px; color: var(--text-dim); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
.next-info { flex: 1; }
.next-info .name { font-size: 13px; font-weight: 700; color: var(--text); }
.next-info .muscles { font-size: 11px; color: var(--text-dim); margin-top: 2px; font-weight: 500; }
.next-abs-badge {
  background: var(--orange-glow); color: var(--orange);
  font-size: 9px; padding: 4px 10px;
  border-radius: 8px; font-weight: 700;
  letter-spacing: 0.3px;
}

/* ====== REST ====== */
.rest-message { text-align: center; padding: 36px 20px; }
.rest-message .icon { font-size: 36px; margin-bottom: 10px; opacity: 0.6; }
.rest-message p { font-size: 14px; line-height: 1.6; color: var(--text-dim); }
.cycle-info {
  text-align: center; padding: 8px;
  color: var(--text-dim); font-size: 11px; font-weight: 600;
  letter-spacing: 0.5px;
}

/* ====== TAB BAR ====== */
.tab-bar {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: rgba(8,8,12,0.92);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid rgba(255,255,255,0.05);
  display: flex; padding: 4px 8px;
  padding-bottom: max(4px, var(--safe-bottom));
  z-index: 100;
}
.tab {
  flex: 1; text-align: center; padding: 8px 4px;
  color: var(--text-dim); font-size: 9px; font-weight: 700;
  cursor: pointer; border: none; background: none;
  transition: all 0.2s; position: relative;
  letter-spacing: 0.3px; text-transform: uppercase;
}
.tab.active { color: var(--green); }
.tab.active .tab-icon { transform: scale(1.1); }
.tab-icon {
  font-size: 20px; display: block; margin-bottom: 2px;
  transition: transform 0.2s;
}
.page { display: none; }
.page.active { display: block; animation: fadeIn 0.2s ease; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* ====== SETTINGS ====== */
.settings-section {
  background: var(--card); border-radius: var(--radius);
  padding: 20px; margin-bottom: 10px;
  border: 1px solid var(--card-border);
}
.settings-section h3 { font-size: 14px; margin-bottom: 10px; font-weight: 700; color: #fff; }
.settings-section label { display: block; font-size: 12px; color: var(--text-dim); margin-bottom: 8px; font-weight: 500; }
.settings-section input[type="date"] {
  width: 100%; padding: 12px 14px;
  background: rgba(255,255,255,0.04); border: 1px solid var(--card-border);
  border-radius: var(--radius-sm); color: var(--text);
  font-size: 15px; font-family: inherit;
}
.settings-section p { font-size: 11px; color: var(--text-dim); margin-top: 10px; line-height: 1.5; }
.calibrate-grid {
  display: grid; grid-template-columns: repeat(4, 1fr);
  gap: 8px; margin-top: 10px;
}
.calibrate-btn {
  padding: 14px 0;
  background: rgba(255,255,255,0.04);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-sm); color: var(--text);
  font-size: 15px; font-weight: 800;
  cursor: pointer; transition: all 0.2s;
  font-family: inherit;
}
.calibrate-btn:active {
  background: var(--green); color: #000;
  border-color: var(--green);
  transform: scale(0.95);
  box-shadow: 0 0 20px rgba(0,210,160,0.3);
}
.all-trainings .training-card { margin-bottom: 10px; }
</style>
</head>
<body>

<div id="page-home" class="page active">
  <div class="header">
    <div class="today-date" id="today-date"></div>
    <div class="today-day" id="today-day"></div>
    <div id="status-badge"></div>
    <div class="quote-box" id="quote-box"></div>
  </div>
  <div id="today-content"></div>
  <div class="month-calendar">
    <div class="month-header">
      <button class="month-nav" onclick="changeMonth(-1)">&#8249;</button>
      <h3 id="month-title"></h3>
      <button class="month-nav" onclick="changeMonth(1)">&#8250;</button>
    </div>
    <div class="month-grid-header">
      <div>Pn</div><div>Wt</div><div>Sr</div><div>Cz</div><div>Pt</div><div>Sb</div><div>Nd</div>
    </div>
    <div class="month-grid" id="month-grid"></div>
  </div>
  <div class="next-trainings">
    <div class="section-title">Nadchodzace treningi</div>
    <div id="next-list"></div>
  </div>
  <div class="cycle-info" id="cycle-info"></div>
</div>

<div id="page-all" class="page">
  <div class="page-title">Treningi</div>
  <div class="all-trainings" id="all-trainings"></div>
</div>

<div id="page-stats" class="page">
  <div class="page-title">Statystyki</div>
  <div class="stats-section">
    <h3>Ten tydzien</h3>
    <div class="week-stats-grid" id="week-stats"></div>
  </div>
  <div class="stats-section body-section">
    <h3>Waga ciala</h3>
    <div class="body-current" id="body-current"></div>
    <div class="body-weight-input-row">
      <input type="number" step="0.1" class="body-weight-input" id="body-weight-input" placeholder="Wpisz wage (kg)">
      <button class="body-weight-save" onclick="saveBodyWeight()">Zapisz</button>
    </div>
    <div class="chart-container" id="body-chart-container"></div>
  </div>
  <div class="stats-section">
    <h3>Progresja ciezarow</h3>
    <div id="ex-progress-list"></div>
  </div>
</div>

<div id="page-settings" class="page">
  <div class="page-title">Ustawienia</div>
  <div class="settings-section">
    <h3>Data startu cyklu</h3>
    <label>Poniedzialek pierwszego tygodnia cyklu</label>
    <input type="date" id="start-date-input">
    <p>Ustaw poniedzialek tygodnia od ktorego zaczynasz Tydzien 1.</p>
  </div>
  <div class="settings-section">
    <h3>Kalibracja treningow</h3>
    <label>Jaki trening miales dzisiaj lub ostatnio?</label>
    <div class="calibrate-grid">
      <button class="calibrate-btn" onclick="calibrate(0)">T1</button>
      <button class="calibrate-btn" onclick="calibrate(1)">T2</button>
      <button class="calibrate-btn" onclick="calibrate(2)">T3</button>
      <button class="calibrate-btn" onclick="calibrate(3)">T4</button>
    </div>
    <p>Kliknij numer treningu zeby skalibrować kolejnosc.</p>
  </div>
</div>

<div class="day-detail-overlay" id="day-detail-overlay" onclick="closeDayDetail(event)">
  <div class="day-detail-panel" id="day-detail-panel"></div>
</div>

<button class="timer-fab" id="timer-fab" onclick="openTimer()">&#9201;</button>

<div class="timer-overlay" id="timer-overlay">
  <button class="timer-close" onclick="closeTimer()">&times;</button>
  <div class="timer-label">Odpoczynek miedzy seriami</div>
  <div class="timer-display" id="timer-display">1:30</div>
  <div class="timer-presets" id="timer-presets">
    <button class="timer-preset" onclick="setTimer(60)">1:00</button>
    <button class="timer-preset active" onclick="setTimer(90)">1:30</button>
    <button class="timer-preset" onclick="setTimer(120)">2:00</button>
    <button class="timer-preset" onclick="setTimer(180)">3:00</button>
  </div>
  <div class="timer-actions" id="timer-actions">
    <button class="timer-start" id="timer-start-btn" onclick="startTimer()">START</button>
  </div>
  <div class="timer-done-msg" id="timer-done-msg" style="display:none">CZAS WRACAC!</div>
</div>

<div class="tab-bar">
  <button class="tab active" onclick="showPage('home')">
    <span class="tab-icon">&#127968;</span>Dzisiaj
  </button>
  <button class="tab" onclick="showPage('all')">
    <span class="tab-icon">&#128170;</span>Treningi
  </button>
  <button class="tab" onclick="showPage('stats')">
    <span class="tab-icon">&#128200;</span>Statystyki
  </button>
  <button class="tab" onclick="showPage('settings')">
    <span class="tab-icon">&#9881;</span>Ustawienia
  </button>
</div>

<script>
const QUOTES = [
  {t:"Nie chodzi o to, zeby byc najlepszym. Chodzi o to, zeby byc lepszym niz wczoraj.", a:"Nieznany"},
  {t:"Bol jest tymczasowy. Rezygnacja jest wieczna.", a:"Lance Armstrong"},
  {t:"Twoje cialo moze zniesc prawie wszystko. To umysl musisz przekonac.", a:"Nieznany"},
  {t:"Sukces to suma malych wysilkow powtarzanych dzien po dniu.", a:"Robert Collier"},
  {t:"Nie licz dni. Spraw, zeby dni sie liczyly.", a:"Muhammad Ali"},
  {t:"Silownia nie zmienia tylko ciala. Zmienia umysl, nastawienie i nastroj.", a:"Nieznany"},
  {t:"Jedyny zly trening to ten, ktory sie nie odbyl.", a:"Nieznany"},
  {t:"Dyscyplina to most miedzy celami a osiagnieciami.", a:"Jim Rohn"},
  {t:"Nie zatrzymuj sie, kiedy jestes zmeczony. Zatrzymaj sie, kiedy skonczysz.", a:"Nieznany"},
  {t:"Kazdy mistrz byl kiedys uczniem, ktory nie chcial sie poddac.", a:"Nieznany"},
  {t:"Ciezka praca bije talent, kiedy talent nie pracuje ciezko.", a:"Tim Notke"},
  {t:"Twoja jedyna granica to Ty sam.", a:"Nieznany"},
  {t:"Nie musisz byc ekstremalny, po prostu badz konsekwentny.", a:"Nieznany"},
  {t:"Marzenia nie dzialaja, dopoki Ty nie zaczniasz dzialac.", a:"John C. Maxwell"},
  {t:"Najlepszy czas na trening byl wczoraj. Drugi najlepszy czas to teraz.", a:"Nieznany"},
  {t:"Wyniki przychodza z czasem, nie z dnia na dzien. Pracuj dalej.", a:"Nieznany"},
  {t:"Sila nie pochodzi z wygrywania. Twoje zmagania buduja sile.", a:"Arnold Schwarzenegger"},
  {t:"Codziennie rób cos, co przybliza Cie do celu.", a:"Nieznany"},
  {t:"Motywacja sprawia, ze zaczynasz. Nawyk sprawia, ze kontynuujesz.", a:"Jim Ryun"},
  {t:"Im ciezej pracujesz, tym lepszym sie stajesz. Bez skrotow.", a:"Nieznany"},
  {t:"Nie oczekuj rezultatow, jesli nie jestes gotowy na wysilek.", a:"Nieznany"},
  {t:"To, co dzisiaj boli, jutro Cie wzmocni.", a:"Nieznany"},
  {t:"Bądz silniejszy niz twoje wymowki.", a:"Nieznany"},
  {t:"Jedna godzina treningu to tylko 4% Twojego dnia. Nie ma wymowek.", a:"Nieznany"},
  {t:"Zrob to teraz. Czasem pozniej znaczy nigdy.", a:"Nieznany"},
  {t:"Nie porownuj sie z innymi. Porownuj sie z soba sprzed miesiaca.", a:"Nieznany"},
  {t:"Silownia jest jak zycie - dostajesz tyle, ile wlozysz.", a:"Nieznany"},
  {t:"Nie czekaj na motywacje. Dzialaj, a motywacja przyjdzie.", a:"Nieznany"},
  {t:"Kazdego dnia masz wybor: poddac sie albo walczyc dalej.", a:"Nieznany"},
  {t:"Pot to tluszcz, ktory plache.", a:"Nieznany"},
  {t:"Progres, nie perfekcja.", a:"Nieznany"},
];

const TRAININGS = [
  {
    name: "Trening 1",
    muscles: "Plecy, Barki, Triceps",
    exercises: [
      { name: "Sciaganie drazka wyciagu gornego do klatki piersiowej", sets: 3, reps: "12, 10, 8", video: "https://youtube.com/shorts/Le1klm9Bs5s?si=XVFblMKMenvJ0mz7" },
      { name: "Sciaganie linki na najszerszy grzbietu", sets: 3, reps: "12, 12, 10", video: "https://youtube.com/shorts/TkTD5h8-Mdw?si=ttSO-fzmDfxhoiYC" },
      { name: "Sciaganie linki jednoracz siedzac", sets: 3, reps: "10, 10, 8", video: "https://www.youtube.com/watch?v=1jN6qeXdvWA" },
      { name: "Unoszenie hantla na barki lezac", sets: 3, reps: "12", video: "https://youtube.com/shorts/Y_V15Zu2cGo?feature=share" },
      { name: "Francuskie wyciskanie sztangi", sets: 3, reps: "12, 10, 10", ts: "2:17", video: "https://www.youtube.com/watch?v=TJkoGDIdRYk&t=46s" },
      { name: "Prostowanie jednoracz na triceps", sets: 3, reps: "12", video: "https://www.youtube.com/shorts/Sf7gJnFqMAs" }
    ]
  },
  {
    name: "Trening 2",
    muscles: "Klatka, Bok Barku, Biceps",
    exercises: [
      { name: "Wyciskanie hantli na lawce plaskiej", sets: 3, reps: "12", video: "https://www.youtube.com/shorts/TCzk4e3jB8c" },
      { name: "Wyciskanie na skosie na maszynie Smith'a", sets: 3, reps: "8, 8, 10", video: "https://www.youtube.com/watch?v=22-yQNZIkN0" },
      { name: "Rozpietki na maszynie Butterfly", sets: 3, reps: "12" },
      { name: "Wznosy na barki za soba", sets: 3, reps: "12", video: "https://youtube.com/shorts/bLQSdfQMtS0?feature=share" },
      { name: "Biceps jednoracz na modlitewniku", sets: 3, reps: "12", video: "https://www.youtube.com/watch?v=fuK3nFvwgXk" },
      { name: "Klasyczne pompki na ziemi", sets: 2, reps: "MAX" }
    ]
  },
  {
    name: "Trening 3",
    muscles: "FBW (Full Body)",
    exercises: [
      { name: "Sciaganie wyciagu szeroko lokcie", sets: 4, reps: "12, 10, 8, 8", video: "https://www.youtube.com/watch?v=094EyLsz7VM" },
      { name: "Wioslowanie na maszynie jednoracz", sets: 3, reps: "10", video: "https://www.youtube.com/shorts/s3gNtp358YE" },
      { name: "Uginanie nog lezac na maszynie", sets: 3, reps: "12, 10, 10", video: "https://www.youtube.com/shorts/xXDQTyI0ESQ" },
      { name: "Przysiady na maszynie Hack Squat", sets: 3, reps: "12, 10, 10", video: "https://www.youtube.com/watch?v=1AVQaldrnOk" },
      { name: "Wypychanie nog na suwnicy", sets: 3, reps: "12, 10, 10", video: "https://www.youtube.com/watch?v=-w1u2DtnPHo&t=1s" },
      { name: "Prostowanie nog na maszynie", sets: 3, reps: "12", video: "https://www.youtube.com/shorts/bkJKXQyOIMM" }
    ]
  },
  {
    name: "Trening 4",
    muscles: "Barki, Gora Klaty, Biceps",
    exercises: [
      { name: "Bok barku na lince", sets: 4, reps: "15, 12, 12, 10", video: "https://www.youtube.com/shorts/gsC3pd6lfKY" },
      { name: "Wyciskanie na gore klatki na hamerze", sets: 3, reps: "10, 10, 10", video: "https://www.youtube.com/watch?v=1BZgo2uGvZQ" },
      { name: "Wyciskanie barkow hantlami siedzac", sets: 3, reps: "8, 8, 8", ts: "49:20", video: "https://www.youtube.com/watch?v=qE-yhtVyRs8&t=1946s" },
      { name: "Przod barku na wyciagu", sets: 3, reps: "12", video: "https://www.youtube.com/shorts/-Scr0kgy200" },
      { name: "Tyl barku na maszynie Butterfly", sets: 3, reps: "12", video: "https://www.youtube.com/shorts/7tJ5ozfR6bk" },
      { name: "Biceps na wyciagu", sets: 3, reps: "12", ts: "1:10", video: "https://www.youtube.com/watch?v=RjmADgjekgA&t=9s" },
      { name: "Biceps 21'", sets: 3, reps: "21", video: "https://www.youtube.com/shorts/jgmESOA4J5E" }
    ]
  }
];

const ABS_EXERCISES = [
  { name: "Deska", sets: 4, reps: "1 min", ts: "1:05", video: "https://www.youtube.com/watch?v=y1hXARqhHZM" },
  { name: "Dead Bug", sets: 4, reps: "20", video: "https://www.youtube.com/watch?v=RvTbAWfLhmE" },
  { name: "Mountain Climber", sets: 4, reps: "12 na noge", ts: "5:11", video: "https://www.youtube.com/watch?v=sDCFiqyt_Rs&t=321s" },
  { name: "Spiecia brzucha", sets: 4, reps: "20", ts: "2:56", video: "https://www.youtube.com/watch?v=sDCFiqyt_Rs&t=321s" }
];

const ABS_SPLITS = [[[0,1],[2,3]],[[0,2],[1,3]],[[0,3],[1,2]]];
const WEEK_TRAINING_DAYS = [[0,2,4,6],[1,2,4,5],[0,2,3,6],[1,3,5,6]];
const DAY_NAMES_FULL = ["Poniedzialek","Wtorek","Sroda","Czwartek","Piatek","Sobota","Niedziela"];
const MONTH_NAMES = ["sty","lut","mar","kwi","maj","cze","lip","sie","wrz","paz","lis","gru"];
const MONTH_NAMES_FULL = ["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","wrzesnia","pazdziernika","listopada","grudnia"];
const MONTH_NAMES_TITLE = ["Styczen","Luty","Marzec","Kwiecien","Maj","Czerwiec","Lipiec","Sierpien","Wrzesien","Pazdziernik","Listopad","Grudzien"];

let currentMonthOffset = 0;
const APP_VERSION = '11';
if (localStorage.getItem('appVersion') !== APP_VERSION) {
  localStorage.removeItem('trainingStartDate');
  localStorage.removeItem('trainingOffset');
  localStorage.setItem('appVersion', APP_VERSION);
}

function getStartDate() { const s = localStorage.getItem('trainingStartDate'); return s ? new Date(s) : new Date('2026-02-09'); }
function getStartTrainingOffset() { const s = localStorage.getItem('trainingOffset'); return s !== null ? parseInt(s) : 2; }
function setStartDate(v) { localStorage.setItem('trainingStartDate', v); render(); }
function setStartTrainingOffset(v) { localStorage.setItem('trainingOffset', v.toString()); render(); }
function getMondayOfWeek(date) { const d = new Date(date); d.setDate(d.getDate() - (d.getDay() === 0 ? 6 : d.getDay() - 1)); d.setHours(0,0,0,0); return d; }
function daysBetween(a, b) { return Math.floor((b - a) / 86400000); }
function getCycleWeek(date) { const w = Math.floor(daysBetween(getMondayOfWeek(getStartDate()), getMondayOfWeek(date)) / 7); return ((w % 4) + 4) % 4; }
function getDayOfWeek(date) { const d = date.getDay(); return d === 0 ? 6 : d - 1; }
function isTrainingDay(date) { return WEEK_TRAINING_DAYS[getCycleWeek(date)].includes(getDayOfWeek(date)); }
function countTrainingDaysBefore(date) {
  const totalWeeks = Math.floor(daysBetween(getMondayOfWeek(getStartDate()), getMondayOfWeek(date)) / 7);
  let count = Math.floor(totalWeeks / 4) * 16;
  const rem = ((totalWeeks % 4) + 4) % 4;
  for (let w = 0; w < rem; w++) count += WEEK_TRAINING_DAYS[w].length;
  const dow = getDayOfWeek(date);
  for (const d of WEEK_TRAINING_DAYS[getCycleWeek(date)]) { if (d < dow) count++; }
  return count;
}
function getTrainingForDate(date) {
  if (!isTrainingDay(date)) return null;
  const seqIdx = countTrainingDaysBefore(date);
  const trainingIdx = ((seqIdx + getStartTrainingOffset()) % 4 + 4) % 4;
  const cw = getCycleWeek(date);
  const posInWeek = WEEK_TRAINING_DAYS[cw].indexOf(getDayOfWeek(date));
  return { training: TRAININGS[trainingIdx], hasAbs: posInWeek === 0 || posInWeek === 2, cycleWeek: cw, trainingIdx };
}
function getAbsForDate(date) {
  const weekNum = Math.floor(daysBetween(getMondayOfWeek(getStartDate()), getMondayOfWeek(date)) / 7);
  const split = ABS_SPLITS[((weekNum % 3) + 3) % 3];
  const cw = getCycleWeek(date);
  const posInWeek = WEEK_TRAINING_DAYS[cw].indexOf(getDayOfWeek(date));
  const indices = split[posInWeek === 0 ? 0 : 1];
  return [ABS_EXERCISES[indices[0]], ABS_EXERCISES[indices[1]]];
}
function formatDate(date) { return `${date.getDate()} ${MONTH_NAMES_FULL[date.getMonth()]} ${date.getFullYear()}`; }
function sameDay(a, b) { return a.getDate() === b.getDate() && a.getMonth() === b.getMonth() && a.getFullYear() === b.getFullYear(); }
function toDateStr(d) { return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }

const YT_SVG = `<svg viewBox="0 0 24 24"><path d="M23.5 6.2a3 3 0 00-2.1-2.1C19.5 3.5 12 3.5 12 3.5s-7.5 0-9.4.6A3 3 0 00.5 6.2 31.4 31.4 0 000 12a31.4 31.4 0 00.5 5.8 3 3 0 002.1 2.1c1.9.6 9.4.6 9.4.6s7.5 0 9.4-.6a3 3 0 002.1-2.1A31.4 31.4 0 0024 12a31.4 31.4 0 00-.5-5.8zM9.5 15.6V8.4l6.3 3.6-6.3 3.6z"/></svg>`;

function getWeightKey(exName) { return 'w_' + exName.replace(/\s+/g, '_').toLowerCase(); }
function getWeightHistory(exName) {
  try { return JSON.parse(localStorage.getItem(getWeightKey(exName))) || []; } catch { return []; }
}
function getSavedWeight(exName) {
  const h = getWeightHistory(exName);
  return h.length > 0 ? h[h.length - 1].kg : '';
}
function saveWeight(exName, val) {
  if (!val) return;
  const h = getWeightHistory(exName);
  const today = toDateStr(new Date());
  const last = h.length > 0 ? h[h.length - 1] : null;
  if (last && last.date === today) { last.kg = val; }
  else { h.push({ date: today, kg: val }); }
  if (h.length > 20) h.splice(0, h.length - 20);
  localStorage.setItem(getWeightKey(exName), JSON.stringify(h));
}
// Migrate old format (single value) to new format (array)
function migrateWeights() {
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key && key.startsWith('w_')) {
      const val = localStorage.getItem(key);
      if (val && !val.startsWith('[')) {
        localStorage.setItem(key, JSON.stringify([{ date: toDateStr(new Date()), kg: val }]));
      }
    }
  }
}
migrateWeights();

function renderExerciseItem(ex, i, numClass, showWeight) {
  let meta = `<span class="exercise-sets">${ex.sets}s &times; ${ex.reps}</span>`;
  if (ex.ts) meta += `<span class="exercise-timestamp">${ex.ts}</span>`;
  let videoHtml = '';
  if (ex.video) {
    const label = ex.ts ? `Technika ${ex.ts}` : 'Technika';
    videoHtml = `<div><a href="${ex.video}" target="_blank" rel="noopener" class="video-btn">${YT_SVG} ${label}</a></div>`;
  }
  let weightHtml = '';
  if (showWeight) {
    const saved = getSavedWeight(ex.name);
    const esc = ex.name.replace(/'/g,"\\'");
    const lastW = saved ? `<span class="weight-last">ostatnio: ${saved} kg</span>` : '';
    weightHtml = `<div class="weight-row"><span class="weight-label">Ciezar:</span><input type="number" step="0.5" class="weight-input" id="wi_${i}" placeholder="kg" value="${saved}"><button class="weight-ok" onclick="saveWeight('${esc}', document.getElementById('wi_${i}').value); this.classList.add('saved'); this.textContent='\\u2713'; setTimeout(()=>{this.classList.remove('saved');this.textContent='OK'},1200)">OK</button>${lastW}</div>`;
  }
  return `<li class="exercise-item"><div class="exercise-num ${numClass}">${i+1}</div><div class="exercise-info"><div class="exercise-name">${ex.name}</div><div class="exercise-meta">${meta}</div>${weightHtml}${videoHtml}</div></li>`;
}

function renderTrainingHtml(tr, date, withWeights) {
  const t = tr.training;
  let html = `<div class="training-card"><h2>${t.name}</h2><div class="subtitle">${t.muscles}</div><ul class="exercise-list">`;
  t.exercises.forEach((ex, i) => { html += renderExerciseItem(ex, i, '', withWeights); });
  html += `</ul></div>`;
  if (tr.hasAbs) {
    const abs = getAbsForDate(date);
    html += `<div class="abs-card"><h3>Brzuch</h3><div class="subtitle">Cwiczenia na brzuch</div><ul class="exercise-list">`;
    abs.forEach((ex, i) => { html += renderExerciseItem(ex, i, 'abs-exercise-num', false); });
    html += `</ul></div>`;
  }
  return html;
}

function openDayDetail(dateStr) {
  const date = new Date(dateStr); date.setHours(0,0,0,0);
  const today = new Date(); today.setHours(0,0,0,0);
  const tr = getTrainingForDate(date);
  let html = `<div class="panel-handle"></div><div class="day-detail-header"><h2>${DAY_NAMES_FULL[getDayOfWeek(date)]}, ${date.getDate()} ${MONTH_NAMES_FULL[date.getMonth()]}</h2><button class="day-detail-close" onclick="closeDayDetail()">&times;</button></div>`;
  if (sameDay(date, today)) html += `<span class="day-detail-badge" style="background:${`var(--purple-glow)`};color:var(--purple);">DZISIAJ</span>`;
  if (tr) {
    html += `<span class="day-detail-badge status-training">TRENING</span>`;
    html += renderTrainingHtml(tr, date, sameDay(date, today));
  } else {
    html += `<span class="day-detail-badge status-rest">ODPOCZYNEK</span>`;
    html += `<div class="rest-message"><div class="icon">&#128564;</div><p>Tego dnia odpoczywasz.</p></div>`;
  }
  document.getElementById('day-detail-panel').innerHTML = html;
  document.getElementById('day-detail-overlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeDayDetail(e) {
  if (e && e.target && e.target !== document.getElementById('day-detail-overlay')) return;
  document.getElementById('day-detail-overlay').classList.remove('open');
  document.body.style.overflow = '';
}

function changeMonth(dir) { currentMonthOffset += dir; renderMonthCalendar(); }

function renderMonthCalendar() {
  const today = new Date(); today.setHours(0,0,0,0);
  const vd = new Date(today.getFullYear(), today.getMonth() + currentMonthOffset, 1);
  const y = vd.getFullYear(), m = vd.getMonth();
  document.getElementById('month-title').textContent = `${MONTH_NAMES_TITLE[m]} ${y}`;
  const startDow = getDayOfWeek(new Date(y, m, 1));
  const dim = new Date(y, m + 1, 0).getDate();
  let html = '';
  for (let i = 0; i < startDow; i++) html += '<div class="mcell empty"></div>';
  for (let d = 1; d <= dim; d++) {
    const date = new Date(y, m, d); date.setHours(0,0,0,0);
    const tr = getTrainingForDate(date);
    const cls = ['mcell'];
    if (sameDay(date, today)) cls.push('today');
    if (tr) cls.push('training-day');
    html += `<div class="${cls.join(' ')}" onclick="openDayDetail('${toDateStr(date)}')"><div class="mday">${d}</div>${tr ? `<div class="mtraining">T${tr.trainingIdx+1}</div>` : ''}${tr && tr.hasAbs ? '<div class="mabs-dot"></div>' : ''}</div>`;
  }
  document.getElementById('month-grid').innerHTML = html;
}

function render() {
  const today = new Date(); today.setHours(0,0,0,0);
  document.getElementById('today-date').textContent = formatDate(today);
  document.getElementById('today-day').textContent = DAY_NAMES_FULL[getDayOfWeek(today)];
  const daysSinceEpoch = Math.floor(today.getTime() / 86400000);
  const q = QUOTES[daysSinceEpoch % QUOTES.length];
  document.getElementById('quote-box').innerHTML = `<span class="quote-icon">&#10077;</span><div class="quote-text">${q.t}</div><div class="quote-author">— ${q.a}</div>`;
  const tr = getTrainingForDate(today);
  if (tr) {
    document.getElementById('status-badge').innerHTML = `<span class="status-badge status-training">Dzien treningowy</span>`;
    document.getElementById('today-content').innerHTML = renderTrainingHtml(tr, today, true) + `<div class="action-row"><button class="action-btn action-done" onclick="markDone()">&#10003; Zrobione</button><button class="action-btn action-skip" onclick="skipTraining()">&#10005; Pomijam</button></div>`;
  } else {
    document.getElementById('status-badge').innerHTML = `<span class="status-badge status-rest">Dzien odpoczynku</span>`;
    document.getElementById('today-content').innerHTML = `<div class="rest-message"><div class="icon">&#128564;</div><p>Dzisiaj odpoczywasz.<br>Regeneracja jest wazna!</p></div>`;
  }
  renderMonthCalendar();
  let nextHtml = '', count = 0, cd = new Date(today);
  cd.setDate(cd.getDate() + 1);
  while (count < 5) {
    const t = getTrainingForDate(cd);
    if (t) {
      const ds = toDateStr(cd);
      nextHtml += `<div class="next-item" onclick="openDayDetail('${ds}')"><div class="next-date"><div class="d">${cd.getDate()}</div><div class="m">${MONTH_NAMES[cd.getMonth()]}</div></div><div class="next-info"><div class="name">${t.training.name}</div><div class="muscles">${t.training.muscles}</div></div>${t.hasAbs ? '<span class="next-abs-badge">+ brzuch</span>' : ''}</div>`;
      count++;
    }
    cd = new Date(cd); cd.setDate(cd.getDate() + 1);
  }
  document.getElementById('next-list').innerHTML = nextHtml;
  document.getElementById('cycle-info').textContent = `Tydzien ${getCycleWeek(today)+1} z 4 w cyklu`;
  let allHtml = '';
  TRAININGS.forEach(t => {
    allHtml += `<div class="training-card"><h3>${t.name}</h3><div class="muscles-tag">${t.muscles}</div><ul class="exercise-list">`;
    t.exercises.forEach((ex, i) => { allHtml += renderExerciseItem(ex, i, '', false); });
    allHtml += `</ul></div>`;
  });
  allHtml += `<div class="abs-card"><h3>Brzuch</h3><div class="subtitle">2x w tygodniu &middot; 2+2 cwiczenia &middot; rotacja co tydzien</div><ul class="exercise-list">`;
  ABS_EXERCISES.forEach((ex, i) => { allHtml += renderExerciseItem(ex, i, 'abs-exercise-num', false); });
  allHtml += `</ul></div>`;
  document.getElementById('all-trainings').innerHTML = allHtml;
  document.getElementById('start-date-input').value = getStartDate().toISOString().split('T')[0];
  renderStats();
}

function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  event.currentTarget.classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

document.getElementById('start-date-input').addEventListener('change', function() { setStartDate(this.value); });

function showToast(type, icon, text) {
  const el = document.createElement('div');
  el.className = `toast toast-${type}`;
  el.innerHTML = `<span class="toast-icon">${icon}</span>${text}`;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 1700);
}
function markDone() {
  showToast('done', '&#128170;', 'Dobra robota!');
}
function skipTraining() {
  const cur = getStartTrainingOffset();
  setStartTrainingOffset(((cur - 1) % 4 + 4) % 4);
  showToast('skip', '&#9193;', 'Trening przesuniety');
}

// ====== TIMER ======
let timerSeconds = 90, timerRemaining = 90, timerInterval = null, timerRunning = false;

function formatTimer(s) {
  const m = Math.floor(s / 60);
  const sec = s % 60;
  return `${m}:${String(sec).padStart(2, '0')}`;
}
function setTimer(s) {
  timerSeconds = s;
  timerRemaining = s;
  timerRunning = false;
  if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
  document.getElementById('timer-display').textContent = formatTimer(s);
  document.getElementById('timer-done-msg').style.display = 'none';
  document.getElementById('timer-start-btn').textContent = 'START';
  document.querySelectorAll('.timer-preset').forEach(b => b.classList.remove('active'));
  document.querySelector(`.timer-preset[onclick="setTimer(${s})"]`)?.classList.add('active');
  document.getElementById('timer-fab').classList.remove('running');
}
function openTimer() {
  document.getElementById('timer-overlay').classList.add('open');
}
function closeTimer() {
  document.getElementById('timer-overlay').classList.remove('open');
}
function startTimer() {
  if (timerRunning) {
    // pause
    clearInterval(timerInterval); timerInterval = null;
    timerRunning = false;
    document.getElementById('timer-start-btn').textContent = 'WZNOW';
    document.getElementById('timer-fab').classList.remove('running');
    return;
  }
  if (timerRemaining <= 0) { setTimer(timerSeconds); }
  timerRunning = true;
  document.getElementById('timer-start-btn').textContent = 'PAUZA';
  document.getElementById('timer-done-msg').style.display = 'none';
  document.getElementById('timer-fab').classList.add('running');
  timerInterval = setInterval(() => {
    timerRemaining--;
    document.getElementById('timer-display').textContent = formatTimer(Math.max(0, timerRemaining));
    document.getElementById('timer-fab').innerHTML = formatTimer(Math.max(0, timerRemaining));
    if (timerRemaining <= 0) {
      clearInterval(timerInterval); timerInterval = null;
      timerRunning = false;
      document.getElementById('timer-done-msg').style.display = 'block';
      document.getElementById('timer-start-btn').textContent = 'RESTART';
      document.getElementById('timer-fab').innerHTML = '&#9201;';
      document.getElementById('timer-fab').classList.remove('running');
      if (navigator.vibrate) navigator.vibrate([300, 100, 300, 100, 300]);
      try {
        const ac = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ac.createOscillator();
        const gain = ac.createGain();
        osc.connect(gain); gain.connect(ac.destination);
        osc.frequency.value = 880;
        gain.gain.value = 0.3;
        osc.start(); osc.stop(ac.currentTime + 0.5);
      } catch(e) {}
    }
  }, 1000);
}

// ====== BODY WEIGHT ======
function getBodyWeightHistory() {
  try { return JSON.parse(localStorage.getItem('bodyWeight')) || []; } catch { return []; }
}
function saveBodyWeight() {
  const input = document.getElementById('body-weight-input');
  const val = input.value;
  if (!val) return;
  const h = getBodyWeightHistory();
  const today = toDateStr(new Date());
  const last = h.length > 0 ? h[h.length - 1] : null;
  if (last && last.date === today) { last.kg = val; }
  else { h.push({ date: today, kg: val }); }
  if (h.length > 60) h.splice(0, h.length - 60);
  localStorage.setItem('bodyWeight', JSON.stringify(h));
  input.value = '';
  showToast('done', '&#9989;', 'Waga zapisana');
  renderStats();
}

// ====== CHART DRAWING ======
function drawChart(canvasId, data, color, unit) {
  const container = document.getElementById(canvasId);
  if (!container) return;
  if (data.length < 2) {
    container.innerHTML = '<div class="chart-empty">Za malo danych na wykres (min. 2 wpisy)</div>';
    return;
  }
  const canvas = document.createElement('canvas');
  container.innerHTML = '';
  container.appendChild(canvas);
  const dpr = window.devicePixelRatio || 1;
  const w = container.offsetWidth;
  const h = 160;
  canvas.width = w * dpr;
  canvas.height = h * dpr;
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);

  const vals = data.map(d => parseFloat(d.kg));
  const min = Math.min(...vals) * 0.95;
  const max = Math.max(...vals) * 1.05;
  const range = max - min || 1;
  const padL = 40, padR = 10, padT = 15, padB = 28;
  const chartW = w - padL - padR;
  const chartH = h - padT - padB;

  // Grid lines
  ctx.strokeStyle = 'rgba(255,255,255,0.05)';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const y = padT + (chartH / 4) * i;
    ctx.beginPath(); ctx.moveTo(padL, y); ctx.lineTo(w - padR, y); ctx.stroke();
    const v = max - (range / 4) * i;
    ctx.fillStyle = 'rgba(255,255,255,0.25)';
    ctx.font = '10px Inter, sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText(v.toFixed(1), padL - 6, y + 3);
  }

  // Line
  ctx.beginPath();
  const points = vals.map((v, i) => ({
    x: padL + (i / (vals.length - 1)) * chartW,
    y: padT + chartH - ((v - min) / range) * chartH
  }));
  ctx.moveTo(points[0].x, points[0].y);
  for (let i = 1; i < points.length; i++) ctx.lineTo(points[i].x, points[i].y);
  ctx.strokeStyle = color;
  ctx.lineWidth = 2.5;
  ctx.lineJoin = 'round';
  ctx.stroke();

  // Fill under
  ctx.lineTo(points[points.length-1].x, padT + chartH);
  ctx.lineTo(points[0].x, padT + chartH);
  ctx.closePath();
  const grad = ctx.createLinearGradient(0, padT, 0, padT + chartH);
  grad.addColorStop(0, color.replace(')', ',0.2)').replace('rgb', 'rgba'));
  grad.addColorStop(1, 'transparent');
  ctx.fillStyle = grad;
  ctx.fill();

  // Dots
  points.forEach((p, i) => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
    ctx.fillStyle = color;
    ctx.fill();
    ctx.beginPath();
    ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
    ctx.fillStyle = '#fff';
    ctx.fill();
  });

  // X labels (first and last date)
  ctx.fillStyle = 'rgba(255,255,255,0.3)';
  ctx.font = '10px Inter, sans-serif';
  ctx.textAlign = 'left';
  ctx.fillText(data[0].date.slice(5), padL, h - 4);
  ctx.textAlign = 'right';
  ctx.fillText(data[data.length-1].date.slice(5), w - padR, h - 4);
}

// ====== STATS RENDERING ======
function renderStats() {
  // Week summary
  const today = new Date(); today.setHours(0,0,0,0);
  const monday = getMondayOfWeek(today);
  let trainingsThisWeek = 0, totalSets = 0;
  for (let i = 0; i < 7; i++) {
    const d = new Date(monday); d.setDate(d.getDate() + i);
    if (d > today) break;
    const tr = getTrainingForDate(d);
    if (tr) {
      trainingsThisWeek++;
      totalSets += tr.training.exercises.reduce((s, ex) => s + ex.sets, 0);
      if (tr.hasAbs) {
        const abs = getAbsForDate(d);
        totalSets += abs.reduce((s, ex) => s + ex.sets, 0);
      }
    }
  }
  // Count remaining this week
  let remainingThisWeek = 0;
  for (let i = 0; i < 7; i++) {
    const d = new Date(monday); d.setDate(d.getDate() + i);
    if (d <= today) continue;
    if (getTrainingForDate(d)) remainingThisWeek++;
  }

  document.getElementById('week-stats').innerHTML = `
    <div class="week-stat"><div class="week-stat-val">${trainingsThisWeek}</div><div class="week-stat-label">Treningi</div></div>
    <div class="week-stat"><div class="week-stat-val">${remainingThisWeek}</div><div class="week-stat-label">Pozostalo</div></div>
    <div class="week-stat"><div class="week-stat-val">${totalSets}</div><div class="week-stat-label">Serie</div></div>
    <div class="week-stat"><div class="week-stat-val">${WEEK_TRAINING_DAYS[getCycleWeek(today)].length}</div><div class="week-stat-label">Plan / tydz</div></div>`;

  // Body weight
  const bw = getBodyWeightHistory();
  let bodyHtml = '';
  if (bw.length > 0) {
    const current = bw[bw.length - 1];
    let changeHtml = '';
    if (bw.length >= 2) {
      const diff = (parseFloat(current.kg) - parseFloat(bw[0].kg)).toFixed(1);
      const sign = diff > 0 ? '+' : '';
      const color = diff > 0 ? 'var(--orange)' : diff < 0 ? 'var(--green)' : 'var(--text-dim)';
      changeHtml = `<div class="body-current-change" style="color:${color}">${sign}${diff} kg od pierwszego pomiaru</div>`;
    }
    bodyHtml = `<div class="body-current-val">${current.kg}</div><div class="body-current-unit">kg &middot; ${current.date.slice(5).replace('-','.')}</div>${changeHtml}`;
  } else {
    bodyHtml = '<div style="color:var(--text-dim);font-size:13px">Brak pomiarow</div>';
  }
  document.getElementById('body-current').innerHTML = bodyHtml;
  drawChart('body-chart-container', bw, 'rgb(124,92,252)', 'kg');

  // Exercise progression
  let allExercises = [];
  TRAININGS.forEach(t => t.exercises.forEach(ex => allExercises.push(ex)));
  let progHtml = '';
  allExercises.forEach(ex => {
    const h = getWeightHistory(ex.name);
    if (h.length === 0) return;
    const first = parseFloat(h[0].kg);
    const last = parseFloat(h[h.length - 1].kg);
    const maxW = Math.max(...h.map(e => parseFloat(e.kg)));
    const pct = maxW > 0 ? (last / maxW * 100) : 0;
    const diff = h.length >= 2 ? (last - first).toFixed(1) : null;
    let diffHtml = '';
    if (diff !== null) {
      const sign = diff > 0 ? '+' : '';
      const color = diff > 0 ? 'var(--green)' : diff < 0 ? 'var(--red)' : 'var(--text-dim)';
      diffHtml = `<span class="ex-progress-current" style="color:${color}">${sign}${diff} kg</span>`;
    }
    progHtml += `<div class="ex-progress-item">
      <div class="ex-progress-name">${ex.name}</div>
      <div class="ex-progress-bar-bg"><div class="ex-progress-bar" style="width:${pct}%"></div></div>
      <div class="ex-progress-vals"><span class="ex-progress-val">${last} kg &middot; ${h.length} wpisow</span>${diffHtml}</div>
    </div>`;
  });
  document.getElementById('ex-progress-list').innerHTML = progHtml || '<div class="chart-empty">Zapisz ciezary w treningu zeby zobaczyc progresje</div>';
}

function calibrate(idx) {
  const today = new Date(); today.setHours(0,0,0,0);
  let d = new Date(today);
  for (let i = 0; i < 7; i++) { if (isTrainingDay(d)) break; d.setDate(d.getDate() - 1); }
  setStartTrainingOffset(((idx - countTrainingDaysBefore(d)) % 4 + 4) % 4);
}

render();

// ====== PWA & NOTIFICATIONS ======
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}

function requestNotifPermission() {
  if ('Notification' in window && Notification.permission === 'default') {
    Notification.requestPermission();
  }
}

function sendTrainingNotification(tr) {
  if (!('Notification' in window) || Notification.permission !== 'granted') return;
  const title = 'Czas na trening! 💪';
  const body = `${tr.training.name} — ${tr.training.muscles}${tr.hasAbs ? ' + Brzuch' : ''}`;
  if (navigator.serviceWorker && navigator.serviceWorker.controller) {
    navigator.serviceWorker.ready.then(reg => {
      reg.showNotification(title, { body, icon: 'icon-192.png', badge: 'icon-192.png', tag: 'training-today' });
    });
  } else {
    new Notification(title, { body, icon: 'icon-192.png', tag: 'training-today' });
  }
}

// Show notification on app open if training day and not already shown today
(function() {
  const today = new Date(); today.setHours(0,0,0,0);
  const todayStr = toDateStr(today);
  const lastNotif = localStorage.getItem('lastNotifDate');
  const tr = getTrainingForDate(today);
  if (tr && lastNotif !== todayStr) {
    localStorage.setItem('lastNotifDate', todayStr);
    if ('Notification' in window) {
      if (Notification.permission === 'granted') {
        setTimeout(() => sendTrainingNotification(tr), 1000);
      } else if (Notification.permission === 'default') {
        Notification.requestPermission().then(p => {
          if (p === 'granted') sendTrainingNotification(tr);
        });
      }
    }
  }
})();
</script>
</body>
</html>
